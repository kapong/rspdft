{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "PDF Template Schema v2.0",
  "description": "Schema for gopdf-rs template files",
  "type": "object",
  "required": ["version", "template", "blocks"],
  "properties": {
    "version": {
      "type": "string",
      "enum": ["2.0"],
      "description": "Template schema version"
    },
    "template": {
      "type": "object",
      "required": ["source"],
      "properties": {
        "source": {
          "type": "string",
          "description": "Path to base PDF file or base64-encoded PDF data"
        },
        "duplicate": {
          "type": "object",
          "description": "Duplicate all blocks with X/Y offset (for duplicate receipts)",
          "properties": {
            "x": { "type": "number", "default": 0 },
            "y": { "type": "number", "default": 0 }
          }
        }
      }
    },
    "fonts": {
      "type": "array",
      "description": "Font definitions",
      "items": {
        "type": "object",
        "required": ["id", "source"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Font identifier used in blocks"
          },
          "family": {
            "type": "string",
            "description": "Font family name (for documentation)"
          },
          "source": {
            "type": "string",
            "description": "Path to TTF file or base64-encoded font data"
          }
        }
      }
    },
    "blocks": {
      "type": "array",
      "description": "Content blocks to render",
      "items": {
        "oneOf": [
          { "$ref": "#/definitions/textBlock" },
          { "$ref": "#/definitions/fieldFormBlock" },
          { "$ref": "#/definitions/tableBlock" },
          { "$ref": "#/definitions/qrcodeBlock" }
        ]
      }
    }
  },
  "definitions": {
    "position": {
      "type": "object",
      "required": ["x", "y"],
      "properties": {
        "x": { 
          "type": "number",
          "description": "X coordinate in PDF points (1/72 inch)"
        },
        "y": { 
          "type": "number",
          "description": "Y coordinate in PDF points (from top)"
        }
      }
    },
    "font": {
      "type": "object",
      "properties": {
        "family": {
          "type": "string",
          "description": "Font ID reference"
        },
        "size": {
          "type": "integer",
          "default": 12,
          "description": "Font size in points"
        },
        "style": {
          "type": "string",
          "enum": ["regular", "bold", "italic", "bold-italic"],
          "default": "regular"
        },
        "color": {
          "type": "object",
          "description": "Text color in RGB (values 0.0-1.0)",
          "properties": {
            "r": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "default": 0.0,
              "description": "Red component (0.0-1.0)"
            },
            "g": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "default": 0.0,
              "description": "Green component (0.0-1.0)"
            },
            "b": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "default": 0.0,
              "description": "Blue component (0.0-1.0)"
            }
          }
        }
      }
    },
    "textBlock": {
      "type": "object",
      "required": ["type", "position"],
      "properties": {
        "id": { 
          "type": "string",
          "description": "Unique block identifier"
        },
        "type": { 
          "const": "text" 
        },
        "bind": { 
          "type": "string", 
          "description": "JSONPath expression for data binding (e.g., $.customer.name)"
        },
        "text": { 
          "type": "string", 
          "description": "Static text (used if bind is not specified)"
        },
        "position": { 
          "$ref": "#/definitions/position" 
        },
        "font": { 
          "$ref": "#/definitions/font" 
        },
        "align": { 
          "type": "string", 
          "enum": ["left", "center", "right"], 
          "default": "left"
        },
        "wordWrap": {
          "type": "object",
          "description": "Word wrapping configuration",
          "properties": {
            "maxChars": { 
              "type": "integer",
              "description": "Maximum characters per line"
            },
            "lineHeight": { 
              "type": "number",
              "description": "Line height in points"
            }
          }
        },
        "format": { 
          "type": "string", 
          "description": "Number format pattern (e.g., #,###.##)"
        },
        "formatType": {
          "type": "string",
          "enum": ["number", "thai-baht", "thai-date-short", "thai-date-long", "thai-year"],
          "description": "Special formatting type"
        },
        "pages": { 
          "type": "array", 
          "items": { "type": "integer" },
          "description": "Page numbers to render on (1-indexed). Empty = all pages"
        }
      }
    },
    "fieldFormBlock": {
      "type": "object",
      "required": ["type", "position", "charSpacing"],
      "description": "Character-by-character field (e.g., tax ID boxes)",
      "properties": {
        "id": { 
          "type": "string" 
        },
        "type": { 
          "const": "fieldform" 
        },
        "bind": { 
          "type": "string",
          "description": "JSONPath expression for data binding"
        },
        "text": {
          "type": "string",
          "description": "Static text (used if bind is not specified)"
        },
        "position": { 
          "$ref": "#/definitions/position" 
        },
        "font": { 
          "$ref": "#/definitions/font" 
        },
        "charSpacing": {
          "type": "array",
          "items": { "type": "number" },
          "description": "X offset for each character position after the first"
        },
        "pages": { 
          "type": "array", 
          "items": { "type": "integer" }
        }
      }
    },
    "tableBlock": {
      "type": "object",
      "required": ["type", "position", "columns"],
      "description": "Multi-row data table",
      "properties": {
        "id": { 
          "type": "string" 
        },
        "type": { 
          "const": "table" 
        },
        "bind": { 
          "type": "string", 
          "description": "JSONPath to array of row objects"
        },
        "position": { 
          "$ref": "#/definitions/position" 
        },
        "font": { 
          "$ref": "#/definitions/font" 
        },
        "rowHeight": { 
          "type": "number", 
          "default": 13.5,
          "description": "Height of each row in points"
        },
        "columns": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["field", "x"],
            "properties": {
              "field": { 
                "type": "string",
                "description": "Field name in row object"
              },
              "x": { 
                "type": "number",
                "description": "X offset from table position"
              },
              "align": { 
                "type": "string", 
                "enum": ["left", "center", "right"],
                "default": "left"
              },
              "wordWrap": { 
                "type": "integer",
                "description": "Max characters for word wrap"
              },
              "format": { 
                "type": "string",
                "description": "Number format pattern"
              }
            }
          }
        },
        "pages": { 
          "type": "array", 
          "items": { "type": "integer" }
        }
      }
    },
    "qrcodeBlock": {
      "type": "object",
      "required": ["type", "position", "size"],
      "description": "QR code image",
      "properties": {
        "id": { 
          "type": "string" 
        },
        "type": { 
          "const": "qrcode" 
        },
        "bind": { 
          "type": "string",
          "description": "JSONPath to QR code data string"
        },
        "data": {
          "type": "string",
          "description": "Static QR code data (used if bind is not specified)"
        },
        "position": { 
          "$ref": "#/definitions/position" 
        },
        "size": {
          "type": "object",
          "required": ["width", "height"],
          "properties": {
            "width": { "type": "number" },
            "height": { "type": "number" }
          }
        },
        "errorCorrection": {
          "type": "string",
          "enum": ["L", "M", "Q", "H"],
          "default": "M",
          "description": "QR code error correction level"
        },
        "pages": { 
          "type": "array", 
          "items": { "type": "integer" }
        }
      }
    }
  }
}
